@using SignalRPractice.WebUI.Models
@model ShapePageViewModel

@{
    ViewBag.Title = "Home Page";
}

<link rel="stylesheet" href="~/Content/index.css" />


<!-- Take shapes from model to be accessed by javascript -->
<script>
    var shapeClasses = new Array();
    var connection; // for SignalR
</script>

@foreach (var shapeClass in Model.Shapes)
{
    <script>
                    shapeClasses.push(@Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(shapeClass, Newtonsoft.Json.Formatting.Indented)));
    </script>
}


<!-- Open SignalR Connection-->
@section Scripts{
    <script type="text/javascript">

        console.log(JSON.stringify('@Model.Shapes'));
        console.log(JSON.stringify(shapeClasses));

        jQuery(document).ready(function ($) {
            console.log("Opening SignalR connection...");
            connection = $.connection("/SignalR/echo");
            connection.error(function (err) {
                alert('Oops! It seems there is a problem. \nError: ' + err.message);
            })
            connection.start()
                .done(function () {
                    if (shapeClasses.length > 0) {
                    /*connection.send(shapeClasses[0]);*/
                        connection.send(shapeClasses);
                    }
                })
                .fail(function () {
                    console.log("Error connecting to realtime service.");
                })
                ;
            connection.received(function (data) {
                console.log('received');
                receiveSignalRData(data);
            })

        });
    </script>
}


<div id="bodyDiv">

    <div class="circle shape" id="circle1" onclick="changeColor('circle1')"></div>

</div>



<script src="~/Scripts/index.js"></script>